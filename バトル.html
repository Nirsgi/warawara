<!DOCTYPE html>
<head>
	<meta charset="UTF-8">
	<title>へへへ。</title>
</head>


<canvas id="canvas"></canvas>
<style>
   overflow: hidden
canvas {
    padding-left: 0;
    padding-right: 0;
    margin-left: auto;
    margin-right: auto;
    display: block;
}
</style>
<body bgcolor="#000000">


<script>
document.body.style.overflow = "hidden";
//canvasの設定（せってい）

canvas.width = window.innerWidth - 10  ;	//canvasの横幅（よこはば）
canvas.height = window.innerHeight - 10  ;	//canvasの縦幅（たてはば）

var widorhei = 1//0=>横長 1=>縦長



var ctx = canvas.getContext( '2d' {willReadFrequently : true});//コンテキストを取得（しゅとく）
var mapimg = new Image();
mapimg.src = 'Map.png' 
mapimg.crossOrigin = "Anonymous"
ctx.imageSmoothingEnabled = false;



var key = new Object(); //移動系
key.y = 0
key.x = 0
key.push = '';

var mv = 0


//設定系
var time = 0
var map = [];
var mapid = 0


function mapc(){

}

function kazu( a ){

if ( a == '0'){return 0}
if ( a == '1'){return 1}
if ( a == '2'){return 2}
if ( a == '3'){return 3}
if ( a == '4'){return 4}
if ( a == '5'){return 5}
if ( a == '6'){return 6}
if ( a == '7'){return 7}
if ( a == '8'){return 8}
if ( a == '9'){return 9}
if ( a == 'A'){return 10}
if ( a == 'B'){return 11}
if ( a == 'C'){return 12}
if ( a == 'D'){return 13}
if ( a == 'E'){return 14}
if ( a == 'F'){return 15}
if ( a == 'G'){return 16}
if ( a == 'H'){return 17}
if ( a == 'I'){return 18}
if ( a == 'J'){return 19}
if ( a == 'K'){return 20}
if ( a == 'L'){return 21}
if ( a == 'M'){return 22}
if ( a == 'N'){return 23}
if ( a == 'O'){return 24}
if ( a == 'P'){return 25}


}


 
function pos(e) {
    var x, y;
    x = e.changedTouches[0].clientX - canvas.getBoundingClientRect().left;
    y = e.changedTouches[0].clientY - canvas.getBoundingClientRect().top;
    return [x, y];
}
function down(x,y){
if ((x - p[t].x) ** 2 + (y - p[t].y) ** 2 < 360 ** 2){
    p[t].xx = (x - p[t].x) / 30
    p[t].yy = (y - p[t].y) / 30
    p[t].ssm = 30
}
}

var color = ['#ff0000','#ffff00','#0000ff','#33ff33','#ff00ff']
function maru(x,y,r,c){
    ctx.beginPath();
    ctx.fillStyle = color[c % 5]
    ctx.arc(x,y,r,0,2*Math.PI);//円を描画
    ctx.closePath();
    ctx.fill();
    ctx.stroke(); 
}

function maru2(x,y,r,c){

    ctx.lineWidth = 3
    ctx.beginPath();
    ctx.strokeStyle = color[c % 5]
    ctx.arc(x,y,r,0,2*Math.PI);//円を描画
    ctx.closePath();
    ctx.stroke(); 
}

function iro(x,y){
if (1 < x && x < canvas.width -1 && 1 < y && canvas.height-1){
var c = ctx.getImageData(x,y,1,1)

if (c[1] < 128 && c[3] > c[1] * 2 && c[3] > c[2]){
return 0.5
}else if (c[2] > 200 && c[1] < c[2] * 0.6 && c[3] < c[2] * 0.6){
return 1
}
 
}else{return 1}

}
mapid = 0

var pp = new Object()
pp.x = 50
pp.y = 50
pp.xx = 0//進み方
pp.yy = 0//進み方
pp.s = 0
pp.ssm = 0

var p = []
p.push(Object.assign({},pp))

p.push(Object.assign({},pp))

p.push(Object.assign({},pp))

p.push(Object.assign({},pp))

var t = 0//どの駒
var tt = 0//仕事した?

function main() {//メインるーーーーーーーーーーーーーーーーーーーーーーーぷ
time += 1;


ctx.drawImage(mapimg,0,0,100,100,0,0,canvas.width,canvas.height)

canvas.addEventListener('touchstart', function(e) {if (e.changedTouches.length == 1){down( pos(e)[0],pos(e)[1]);mv = 1}});
if (mv == 0){canvas.addEventListener('mousedown', function(e) {down(e.clientX,e.clientY)});}



for (i = 0;i < p.length;i += 1){

if (t == i){

   maru2(p[i].x,p[i].y,360,p[i].s)
if (tt == 1 && p[i].ssm == 0){
t += 1
tt = 0
}

}
   if (p[i].ssm > 0){

	p[i].x +=  p[i].xx * iro(p[i].x,p[i].y)
	p[i].y +=  p[i].yy * iro(p[i].x,p[i].y)
	p[i].ssm -= 1
        tt = 1
   }


   maru(p[i].x,p[i].y,30,p[i].s)
}

if (t >= p.length){
t = 0
}
if (time > 10000){time = 0}
requestAnimationFrame(main);
}

//ページと依存（いぞん）している全てのデータが読み込まれたら、メインループ開始
addEventListener('load', main(), false);
	</script>
</body>
</html>
